import{j as h}from"./ui-TC4ngNOa.js";import{R as m,G as ar,g as or,c as X,r as z}from"./vendor-DXsvu-ZH.js";import{u as lr,c as ts,S as cr,B as xt,X as dr,N as ur,a as ot,L as hr,M as fr,C as ks,O as gr,b as pr,d as Pt,F as Ss,e as oe,f as le,g as ce,h as de,T as ss,A as mr,U as vr,i as Fe,P as rs,j as yr}from"./assessment-Bi8Jn170.js";var wr=r=>{switch(r){case"success":return xr;case"info":return Sr;case"warning":return kr;case"error":return jr;default:return null}},br=Array(12).fill(0),_r=({visible:r})=>m.createElement("div",{className:"sonner-loading-wrapper","data-visible":r},m.createElement("div",{className:"sonner-spinner"},br.map((e,t)=>m.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${t}`})))),xr=m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},m.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),kr=m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},m.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),Sr=m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},m.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),jr=m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},m.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Er=()=>{let[r,e]=m.useState(document.hidden);return m.useEffect(()=>{let t=()=>{e(document.hidden)};return document.addEventListener("visibilitychange",t),()=>window.removeEventListener("visibilitychange",t)},[]),r},Ct=1,Tr=class{constructor(){this.subscribe=r=>(this.subscribers.push(r),()=>{let e=this.subscribers.indexOf(r);this.subscribers.splice(e,1)}),this.publish=r=>{this.subscribers.forEach(e=>e(r))},this.addToast=r=>{this.publish(r),this.toasts=[...this.toasts,r]},this.create=r=>{var e;let{message:t,...s}=r,n=typeof(r==null?void 0:r.id)=="number"||((e=r.id)==null?void 0:e.length)>0?r.id:Ct++,i=this.toasts.find(o=>o.id===n),a=r.dismissible===void 0?!0:r.dismissible;return i?this.toasts=this.toasts.map(o=>o.id===n?(this.publish({...o,...r,id:n,title:t}),{...o,...r,id:n,dismissible:a,title:t}):o):this.addToast({title:t,...s,dismissible:a,id:n}),n},this.dismiss=r=>(r||this.toasts.forEach(e=>{this.subscribers.forEach(t=>t({id:e.id,dismiss:!0}))}),this.subscribers.forEach(e=>e({id:r,dismiss:!0})),r),this.message=(r,e)=>this.create({...e,message:r}),this.error=(r,e)=>this.create({...e,message:r,type:"error"}),this.success=(r,e)=>this.create({...e,type:"success",message:r}),this.info=(r,e)=>this.create({...e,type:"info",message:r}),this.warning=(r,e)=>this.create({...e,type:"warning",message:r}),this.loading=(r,e)=>this.create({...e,type:"loading",message:r}),this.promise=(r,e)=>{if(!e)return;let t;e.loading!==void 0&&(t=this.create({...e,promise:r,type:"loading",message:e.loading,description:typeof e.description!="function"?e.description:void 0}));let s=r instanceof Promise?r:r(),n=t!==void 0;return s.then(async i=>{if(Or(i)&&!i.ok){n=!1;let a=typeof e.error=="function"?await e.error(`HTTP error! status: ${i.status}`):e.error,o=typeof e.description=="function"?await e.description(`HTTP error! status: ${i.status}`):e.description;this.create({id:t,type:"error",message:a,description:o})}else if(e.success!==void 0){n=!1;let a=typeof e.success=="function"?await e.success(i):e.success,o=typeof e.description=="function"?await e.description(i):e.description;this.create({id:t,type:"success",message:a,description:o})}}).catch(async i=>{if(e.error!==void 0){n=!1;let a=typeof e.error=="function"?await e.error(i):e.error,o=typeof e.description=="function"?await e.description(i):e.description;this.create({id:t,type:"error",message:a,description:o})}}).finally(()=>{var i;n&&(this.dismiss(t),t=void 0),(i=e.finally)==null||i.call(e)}),t},this.custom=(r,e)=>{let t=(e==null?void 0:e.id)||Ct++;return this.create({jsx:r(t),id:t,...e}),t},this.subscribers=[],this.toasts=[]}},G=new Tr,Ar=(r,e)=>{let t=(e==null?void 0:e.id)||Ct++;return G.addToast({title:r,...e,id:t}),t},Or=r=>r&&typeof r=="object"&&"ok"in r&&typeof r.ok=="boolean"&&"status"in r&&typeof r.status=="number",Pr=Ar,Cr=()=>G.toasts,We=Object.assign(Pr,{success:G.success,info:G.info,warning:G.warning,error:G.error,custom:G.custom,message:G.message,promise:G.promise,dismiss:G.dismiss,loading:G.loading},{getHistory:Cr});function $r(r,{insertAt:e}={}){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",e==="top"&&t.firstChild?t.insertBefore(s,t.firstChild):t.appendChild(s),s.styleSheet?s.styleSheet.cssText=r:s.appendChild(document.createTextNode(r))}$r(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999}:where([data-sonner-toaster][data-x-position="right"]){right:max(var(--offset),env(safe-area-inset-right))}:where([data-sonner-toaster][data-x-position="left"]){left:max(var(--offset),env(safe-area-inset-left))}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:max(var(--offset),env(safe-area-inset-top))}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:max(var(--offset),env(safe-area-inset-bottom))}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;background:var(--gray1);color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:0;right:0;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount, 0px));transition:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation:swipe-out .2s ease-out forwards}@keyframes swipe-out{0%{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount)));opacity:1}to{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount) + var(--lift) * -100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;--mobile-offset: 16px;right:var(--mobile-offset);left:var(--mobile-offset);width:100%}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset)}[data-sonner-toaster][data-y-position=bottom]{bottom:20px}[data-sonner-toaster][data-y-position=top]{top:20px}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset);right:var(--mobile-offset);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function st(r){return r.label!==void 0}var Rr=3,Ir="32px",Nr=4e3,Ur=356,Lr=14,Dr=20,Br=200;function Mr(...r){return r.filter(Boolean).join(" ")}var qr=r=>{var e,t,s,n,i,a,o,l,c,d;let{invert:f,toast:u,unstyled:g,interacting:p,setHeights:v,visibleToasts:y,heights:S,index:A,toasts:w,expanded:x,removeToast:_,defaultRichColors:b,closeButton:O,style:H,cancelButtonStyle:Y,actionButtonStyle:ae,className:W="",descriptionClassName:Z="",duration:N,position:j,gap:k,loadingIcon:V,expandByDefault:je,classNames:C,icons:ee,closeButtonAriaLabel:vt="Close toast",pauseWhenPageIsHidden:$,cn:U}=r,[D,re]=m.useState(!1),[we,M]=m.useState(!1),[yt,Me]=m.useState(!1),[qe,ze]=m.useState(!1),[Gs,wt]=m.useState(0),[Ys,Vt]=m.useState(0),Gt=m.useRef(null),Ee=m.useRef(null),Qs=A===0,Xs=A+1<=y,Q=u.type,Te=u.dismissible!==!1,Zs=u.className||"",er=u.descriptionClassName||"",et=m.useMemo(()=>S.findIndex(T=>T.toastId===u.id)||0,[S,u.id]),tr=m.useMemo(()=>{var T;return(T=u.closeButton)!=null?T:O},[u.closeButton,O]),Yt=m.useMemo(()=>u.duration||N||Nr,[u.duration,N]),bt=m.useRef(0),Ae=m.useRef(0),Qt=m.useRef(0),Oe=m.useRef(null),[Xt,sr]=j.split("-"),Zt=m.useMemo(()=>S.reduce((T,L,R)=>R>=et?T:T+L.height,0),[S,et]),es=Er(),rr=u.invert||f,_t=Q==="loading";Ae.current=m.useMemo(()=>et*k+Zt,[et,Zt]),m.useEffect(()=>{re(!0)},[]),m.useLayoutEffect(()=>{if(!D)return;let T=Ee.current,L=T.style.height;T.style.height="auto";let R=T.getBoundingClientRect().height;T.style.height=L,Vt(R),v(ne=>ne.find(ie=>ie.toastId===u.id)?ne.map(ie=>ie.toastId===u.id?{...ie,height:R}:ie):[{toastId:u.id,height:R,position:u.position},...ne])},[D,u.title,u.description,v,u.id]);let ge=m.useCallback(()=>{M(!0),wt(Ae.current),v(T=>T.filter(L=>L.toastId!==u.id)),setTimeout(()=>{_(u)},Br)},[u,_,v,Ae]);m.useEffect(()=>{if(u.promise&&Q==="loading"||u.duration===1/0||u.type==="loading")return;let T,L=Yt;return x||p||$&&es?(()=>{if(Qt.current<bt.current){let R=new Date().getTime()-bt.current;L=L-R}Qt.current=new Date().getTime()})():L!==1/0&&(bt.current=new Date().getTime(),T=setTimeout(()=>{var R;(R=u.onAutoClose)==null||R.call(u,u),ge()},L)),()=>clearTimeout(T)},[x,p,je,u,Yt,ge,u.promise,Q,$,es]),m.useEffect(()=>{let T=Ee.current;if(T){let L=T.getBoundingClientRect().height;return Vt(L),v(R=>[{toastId:u.id,height:L,position:u.position},...R]),()=>v(R=>R.filter(ne=>ne.toastId!==u.id))}},[v,u.id]),m.useEffect(()=>{u.delete&&ge()},[ge,u.delete]);function nr(){return ee!=null&&ee.loading?m.createElement("div",{className:"sonner-loader","data-visible":Q==="loading"},ee.loading):V?m.createElement("div",{className:"sonner-loader","data-visible":Q==="loading"},V):m.createElement(_r,{visible:Q==="loading"})}return m.createElement("li",{"aria-live":u.important?"assertive":"polite","aria-atomic":"true",role:"status",tabIndex:0,ref:Ee,className:U(W,Zs,C==null?void 0:C.toast,(e=u==null?void 0:u.classNames)==null?void 0:e.toast,C==null?void 0:C.default,C==null?void 0:C[Q],(t=u==null?void 0:u.classNames)==null?void 0:t[Q]),"data-sonner-toast":"","data-rich-colors":(s=u.richColors)!=null?s:b,"data-styled":!(u.jsx||u.unstyled||g),"data-mounted":D,"data-promise":!!u.promise,"data-removed":we,"data-visible":Xs,"data-y-position":Xt,"data-x-position":sr,"data-index":A,"data-front":Qs,"data-swiping":yt,"data-dismissible":Te,"data-type":Q,"data-invert":rr,"data-swipe-out":qe,"data-expanded":!!(x||je&&D),style:{"--index":A,"--toasts-before":A,"--z-index":w.length-A,"--offset":`${we?Gs:Ae.current}px`,"--initial-height":je?"auto":`${Ys}px`,...H,...u.style},onPointerDown:T=>{_t||!Te||(Gt.current=new Date,wt(Ae.current),T.target.setPointerCapture(T.pointerId),T.target.tagName!=="BUTTON"&&(Me(!0),Oe.current={x:T.clientX,y:T.clientY}))},onPointerUp:()=>{var T,L,R,ne;if(qe||!Te)return;Oe.current=null;let ie=Number(((T=Ee.current)==null?void 0:T.style.getPropertyValue("--swipe-amount").replace("px",""))||0),tt=new Date().getTime()-((L=Gt.current)==null?void 0:L.getTime()),ir=Math.abs(ie)/tt;if(Math.abs(ie)>=Dr||ir>.11){wt(Ae.current),(R=u.onDismiss)==null||R.call(u,u),ge(),ze(!0);return}(ne=Ee.current)==null||ne.style.setProperty("--swipe-amount","0px"),Me(!1)},onPointerMove:T=>{var L;if(!Oe.current||!Te)return;let R=T.clientY-Oe.current.y,ne=T.clientX-Oe.current.x,ie=(Xt==="top"?Math.min:Math.max)(0,R),tt=T.pointerType==="touch"?10:2;Math.abs(ie)>tt?(L=Ee.current)==null||L.style.setProperty("--swipe-amount",`${R}px`):Math.abs(ne)>tt&&(Oe.current=null)}},tr&&!u.jsx?m.createElement("button",{"aria-label":vt,"data-disabled":_t,"data-close-button":!0,onClick:_t||!Te?()=>{}:()=>{var T;ge(),(T=u.onDismiss)==null||T.call(u,u)},className:U(C==null?void 0:C.closeButton,(n=u==null?void 0:u.classNames)==null?void 0:n.closeButton)},m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},m.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),m.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))):null,u.jsx||m.isValidElement(u.title)?u.jsx||u.title:m.createElement(m.Fragment,null,Q||u.icon||u.promise?m.createElement("div",{"data-icon":"",className:U(C==null?void 0:C.icon,(i=u==null?void 0:u.classNames)==null?void 0:i.icon)},u.promise||u.type==="loading"&&!u.icon?u.icon||nr():null,u.type!=="loading"?u.icon||(ee==null?void 0:ee[Q])||wr(Q):null):null,m.createElement("div",{"data-content":"",className:U(C==null?void 0:C.content,(a=u==null?void 0:u.classNames)==null?void 0:a.content)},m.createElement("div",{"data-title":"",className:U(C==null?void 0:C.title,(o=u==null?void 0:u.classNames)==null?void 0:o.title)},u.title),u.description?m.createElement("div",{"data-description":"",className:U(Z,er,C==null?void 0:C.description,(l=u==null?void 0:u.classNames)==null?void 0:l.description)},u.description):null),m.isValidElement(u.cancel)?u.cancel:u.cancel&&st(u.cancel)?m.createElement("button",{"data-button":!0,"data-cancel":!0,style:u.cancelButtonStyle||Y,onClick:T=>{var L,R;st(u.cancel)&&Te&&((R=(L=u.cancel).onClick)==null||R.call(L,T),ge())},className:U(C==null?void 0:C.cancelButton,(c=u==null?void 0:u.classNames)==null?void 0:c.cancelButton)},u.cancel.label):null,m.isValidElement(u.action)?u.action:u.action&&st(u.action)?m.createElement("button",{"data-button":!0,"data-action":!0,style:u.actionButtonStyle||ae,onClick:T=>{var L,R;st(u.action)&&(T.defaultPrevented||((R=(L=u.action).onClick)==null||R.call(L,T),ge()))},className:U(C==null?void 0:C.actionButton,(d=u==null?void 0:u.classNames)==null?void 0:d.actionButton)},u.action.label):null))};function ns(){if(typeof window>"u"||typeof document>"u")return"ltr";let r=document.documentElement.getAttribute("dir");return r==="auto"||!r?window.getComputedStyle(document.documentElement).direction:r}var ma=r=>{let{invert:e,position:t="bottom-right",hotkey:s=["altKey","KeyT"],expand:n,closeButton:i,className:a,offset:o,theme:l="light",richColors:c,duration:d,style:f,visibleToasts:u=Rr,toastOptions:g,dir:p=ns(),gap:v=Lr,loadingIcon:y,icons:S,containerAriaLabel:A="Notifications",pauseWhenPageIsHidden:w,cn:x=Mr}=r,[_,b]=m.useState([]),O=m.useMemo(()=>Array.from(new Set([t].concat(_.filter($=>$.position).map($=>$.position)))),[_,t]),[H,Y]=m.useState([]),[ae,W]=m.useState(!1),[Z,N]=m.useState(!1),[j,k]=m.useState(l!=="system"?l:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),V=m.useRef(null),je=s.join("+").replace(/Key/g,"").replace(/Digit/g,""),C=m.useRef(null),ee=m.useRef(!1),vt=m.useCallback($=>{var U;(U=_.find(D=>D.id===$.id))!=null&&U.delete||G.dismiss($.id),b(D=>D.filter(({id:re})=>re!==$.id))},[_]);return m.useEffect(()=>G.subscribe($=>{if($.dismiss){b(U=>U.map(D=>D.id===$.id?{...D,delete:!0}:D));return}setTimeout(()=>{ar.flushSync(()=>{b(U=>{let D=U.findIndex(re=>re.id===$.id);return D!==-1?[...U.slice(0,D),{...U[D],...$},...U.slice(D+1)]:[$,...U]})})})}),[]),m.useEffect(()=>{if(l!=="system"){k(l);return}l==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?k("dark"):k("light")),typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:$})=>{k($?"dark":"light")})},[l]),m.useEffect(()=>{_.length<=1&&W(!1)},[_]),m.useEffect(()=>{let $=U=>{var D,re;s.every(we=>U[we]||U.code===we)&&(W(!0),(D=V.current)==null||D.focus()),U.code==="Escape"&&(document.activeElement===V.current||(re=V.current)!=null&&re.contains(document.activeElement))&&W(!1)};return document.addEventListener("keydown",$),()=>document.removeEventListener("keydown",$)},[s]),m.useEffect(()=>{if(V.current)return()=>{C.current&&(C.current.focus({preventScroll:!0}),C.current=null,ee.current=!1)}},[V.current]),_.length?m.createElement("section",{"aria-label":`${A} ${je}`,tabIndex:-1},O.map(($,U)=>{var D;let[re,we]=$.split("-");return m.createElement("ol",{key:$,dir:p==="auto"?ns():p,tabIndex:-1,ref:V,className:a,"data-sonner-toaster":!0,"data-theme":j,"data-y-position":re,"data-x-position":we,style:{"--front-toast-height":`${((D=H[0])==null?void 0:D.height)||0}px`,"--offset":typeof o=="number"?`${o}px`:o||Ir,"--width":`${Ur}px`,"--gap":`${v}px`,...f},onBlur:M=>{ee.current&&!M.currentTarget.contains(M.relatedTarget)&&(ee.current=!1,C.current&&(C.current.focus({preventScroll:!0}),C.current=null))},onFocus:M=>{M.target instanceof HTMLElement&&M.target.dataset.dismissible==="false"||ee.current||(ee.current=!0,C.current=M.relatedTarget)},onMouseEnter:()=>W(!0),onMouseMove:()=>W(!0),onMouseLeave:()=>{Z||W(!1)},onPointerDown:M=>{M.target instanceof HTMLElement&&M.target.dataset.dismissible==="false"||N(!0)},onPointerUp:()=>N(!1)},_.filter(M=>!M.position&&U===0||M.position===$).map((M,yt)=>{var Me,qe;return m.createElement(qr,{key:M.id,icons:S,index:yt,toast:M,defaultRichColors:c,duration:(Me=g==null?void 0:g.duration)!=null?Me:d,className:g==null?void 0:g.className,descriptionClassName:g==null?void 0:g.descriptionClassName,invert:e,visibleToasts:u,closeButton:(qe=g==null?void 0:g.closeButton)!=null?qe:i,interacting:Z,position:$,style:g==null?void 0:g.style,unstyled:g==null?void 0:g.unstyled,classNames:g==null?void 0:g.classNames,cancelButtonStyle:g==null?void 0:g.cancelButtonStyle,actionButtonStyle:g==null?void 0:g.actionButtonStyle,removeToast:vt,toasts:_.filter(ze=>ze.position==M.position),heights:H.filter(ze=>ze.position==M.position),setHeights:Y,expandByDefault:n,gap:v,loadingIcon:y,expanded:ae,pauseWhenPageIsHidden:w,cn:x})}))})):null};const zr="modulepreload",Fr=function(r){return"/"+r},is={},Qe=function(e,t,s){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(t.map(l=>{if(l=Fr(l),l in is)return;is[l]=!0;const c=l.endsWith(".css"),d=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":zr,c||(f.as="script"),f.crossOrigin="",f.href=l,o&&f.setAttribute("nonce",o),document.head.appendChild(f),c)return new Promise((u,g)=>{f.addEventListener("load",u),f.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return n.then(a=>{for(const o of a||[])o.status==="rejected"&&i(o.reason);return e().catch(i)})},Wr=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Qe(async()=>{const{default:s}=await Promise.resolve().then(()=>De);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class Ft extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class Hr extends Ft{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class as extends Ft{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class os extends Ft{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var $t;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})($t||($t={}));var Kr=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(d){try{c(s.next(d))}catch(f){a(f)}}function l(d){try{c(s.throw(d))}catch(f){a(f)}}function c(d){d.done?i(d.value):n(d.value).then(o,l)}c((s=s.apply(r,e||[])).next())})};class Jr{constructor(e,{headers:t={},customFetch:s,region:n=$t.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=Wr(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return Kr(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:a}=t;let o={},{region:l}=t;l||(l=this.region);const c=new URL(`${this.url}/${e}`);l&&l!=="any"&&(o["x-region"]=l,c.searchParams.set("forceFunctionRegion",l));let d;a&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",d=a):typeof a=="string"?(o["Content-Type"]="text/plain",d=a):typeof FormData<"u"&&a instanceof FormData?d=a:(o["Content-Type"]="application/json",d=JSON.stringify(a)));const f=yield this.fetch(c.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),n),body:d}).catch(v=>{throw new Hr(v)}),u=f.headers.get("x-relay-error");if(u&&u==="true")throw new as(f);if(!f.ok)throw new os(f);let g=((s=f.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),p;return g==="application/json"?p=yield f.json():g==="application/octet-stream"?p=yield f.blob():g==="text/event-stream"?p=f:g==="multipart/form-data"?p=yield f.formData():p=yield f.text(),{data:p,error:null,response:f}}catch(n){return{data:null,error:n,response:n instanceof os||n instanceof as?n.context:void 0}}})}}var J={},Wt={},dt={},Xe={},ut={},ht={},Vr=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Le=Vr();const Gr=Le.fetch,js=Le.fetch.bind(Le),Es=Le.Headers,Yr=Le.Request,Qr=Le.Response,De=Object.freeze(Object.defineProperty({__proto__:null,Headers:Es,Request:Yr,Response:Qr,default:js,fetch:Gr},Symbol.toStringTag,{value:"Module"})),Xr=or(De);var ft={};Object.defineProperty(ft,"__esModule",{value:!0});let Zr=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};ft.default=Zr;var Ts=X&&X.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ht,"__esModule",{value:!0});const en=Ts(Xr),tn=Ts(ft);let sn=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=en.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const s=this.fetch;let n=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var a,o,l;let c=null,d=null,f=null,u=i.status,g=i.statusText;if(i.ok){if(this.method!=="HEAD"){const S=await i.text();S===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?d=S:d=JSON.parse(S))}const v=(a=this.headers.Prefer)===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),y=(o=i.headers.get("content-range"))===null||o===void 0?void 0:o.split("/");v&&y&&y.length>1&&(f=parseInt(y[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(d)&&(d.length>1?(c={code:"PGRST116",details:`Results contain ${d.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},d=null,f=null,u=406,g="Not Acceptable"):d.length===1?d=d[0]:d=null)}else{const v=await i.text();try{c=JSON.parse(v),Array.isArray(c)&&i.status===404&&(d=[],c=null,u=200,g="OK")}catch{i.status===404&&v===""?(u=204,g="No Content"):c={message:v}}if(c&&this.isMaybeSingle&&(!((l=c==null?void 0:c.details)===null||l===void 0)&&l.includes("0 rows"))&&(c=null,u=200,g="OK"),c&&this.shouldThrowOnError)throw new tn.default(c)}return{error:c,data:d,count:f,status:u,statusText:g}});return this.shouldThrowOnError||(n=n.catch(i=>{var a,o,l;return{error:{message:`${(a=i==null?void 0:i.name)!==null&&a!==void 0?a:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(o=i==null?void 0:i.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(l=i==null?void 0:i.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}returns(){return this}overrideTypes(){return this}};ht.default=sn;var rn=X&&X.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ut,"__esModule",{value:!0});const nn=rn(ht);let an=class extends nn.default{select(e){let t=!1;const s=(e??"*").split("").map(n=>/\s/.test(n)&&!t?"":(n==='"'&&(t=!t),n)).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:n,referencedTable:i=n}={}){const a=i?`${i}.order`:"order",o=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const n=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:n=s}={}){const i=typeof n>"u"?"offset":`${n}.offset`,a=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(a,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:n=!1,wal:i=!1,format:a="text"}={}){var o;const l=[e?"analyze":null,t?"verbose":null,s?"settings":null,n?"buffers":null,i?"wal":null].filter(Boolean).join("|"),c=(o=this.headers.Accept)!==null&&o!==void 0?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${a}; for="${c}"; options=${l};`,a==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};ut.default=an;var on=X&&X.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Xe,"__esModule",{value:!0});const ln=on(ut);let cn=class extends ln.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:n}={}){let i="";n==="plain"?i="pl":n==="phrase"?i="ph":n==="websearch"&&(i="w");const a=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${i}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const n=s?`${s}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};Xe.default=cn;var dn=X&&X.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(dt,"__esModule",{value:!0});const He=dn(Xe);let un=class{constructor(e,{headers:t={},schema:s,fetch:n}){this.url=e,this.headers=t,this.schema=s,this.fetch=n}select(e,{head:t=!1,count:s}={}){const n=t?"HEAD":"GET";let i=!1;const a=(e??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",a),s&&(this.headers.Prefer=`count=${s}`),new He.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const n="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),s||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const a=e.reduce((o,l)=>o.concat(Object.keys(l)),[]);if(a.length>0){const o=[...new Set(a)].map(l=>`"${l}"`);this.url.searchParams.set("columns",o.join(","))}}return new He.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:n,defaultToNull:i=!0}={}){const a="POST",o=[`resolution=${s?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&o.push(this.headers.Prefer),n&&o.push(`count=${n}`),i||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const l=e.reduce((c,d)=>c.concat(Object.keys(d)),[]);if(l.length>0){const c=[...new Set(l)].map(d=>`"${d}"`);this.url.searchParams.set("columns",c.join(","))}}return new He.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s="PATCH",n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),this.headers.Prefer=n.join(","),new He.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",s=[];return e&&s.push(`count=${e}`),this.headers.Prefer&&s.unshift(this.headers.Prefer),this.headers.Prefer=s.join(","),new He.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};dt.default=un;var gt={},pt={};Object.defineProperty(pt,"__esModule",{value:!0});pt.version=void 0;pt.version="0.0.0-automated";Object.defineProperty(gt,"__esModule",{value:!0});gt.DEFAULT_HEADERS=void 0;const hn=pt;gt.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${hn.version}`};var As=X&&X.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Wt,"__esModule",{value:!0});const fn=As(dt),gn=As(Xe),pn=gt;let mn=class Os{constructor(e,{headers:t={},schema:s,fetch:n}={}){this.url=e,this.headers=Object.assign(Object.assign({},pn.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=n}from(e){const t=new URL(`${this.url}/${e}`);return new fn.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Os(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:n=!1,count:i}={}){let a;const o=new URL(`${this.url}/rpc/${e}`);let l;s||n?(a=s?"HEAD":"GET",Object.entries(t).filter(([d,f])=>f!==void 0).map(([d,f])=>[d,Array.isArray(f)?`{${f.join(",")}}`:`${f}`]).forEach(([d,f])=>{o.searchParams.append(d,f)})):(a="POST",l=t);const c=Object.assign({},this.headers);return i&&(c.Prefer=`count=${i}`),new gn.default({method:a,url:o,headers:c,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}};Wt.default=mn;var Be=X&&X.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(J,"__esModule",{value:!0});J.PostgrestError=J.PostgrestBuilder=J.PostgrestTransformBuilder=J.PostgrestFilterBuilder=J.PostgrestQueryBuilder=J.PostgrestClient=void 0;const Ps=Be(Wt);J.PostgrestClient=Ps.default;const Cs=Be(dt);J.PostgrestQueryBuilder=Cs.default;const $s=Be(Xe);J.PostgrestFilterBuilder=$s.default;const Rs=Be(ut);J.PostgrestTransformBuilder=Rs.default;const Is=Be(ht);J.PostgrestBuilder=Is.default;const Ns=Be(ft);J.PostgrestError=Ns.default;var vn=J.default={PostgrestClient:Ps.default,PostgrestQueryBuilder:Cs.default,PostgrestFilterBuilder:$s.default,PostgrestTransformBuilder:Rs.default,PostgrestBuilder:Is.default,PostgrestError:Ns.default};const{PostgrestClient:yn,PostgrestQueryBuilder:xa,PostgrestFilterBuilder:ka,PostgrestTransformBuilder:Sa,PostgrestBuilder:ja,PostgrestError:Ea}=vn;class wn{static dynamicRequire(e){try{return typeof process<"u"&&process.versions&&process.versions.node&&typeof require<"u"?require(e):null}catch{return null}}static detectEnvironment(){var e,t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const s=parseInt(process.versions.node.split(".")[0]);if(s>=22)try{if(typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};const n=this.dynamicRequire("undici");if(n&&n.WebSocket)return{type:"native",constructor:n.WebSocket};throw new Error("undici not available")}catch{return{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:'Install the "ws" package or check your Node.js installation.'}}try{const n=this.dynamicRequire("ws");if(n)return{type:"ws",constructor:(t=n.WebSocket)!==null&&t!==void 0?t:n};throw new Error("ws package not available")}catch{return{type:"unsupported",error:`Node.js ${s} detected without WebSocket support.`,workaround:'Install the "ws" package: npm install ws'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const s=this.getWebSocketConstructor();return new s(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const bn="2.15.0",_n=`realtime-js/${bn}`,xn="1.0.0",Rt=1e4,kn=1e3,Sn=100;var Je;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(Je||(Je={}));var q;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(q||(q={}));var se;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(se||(se={}));var It;(function(r){r.websocket="websocket"})(It||(It={}));var ke;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(ke||(ke={}));class jn{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const n=t.getUint8(1),i=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=s.decode(e.slice(a,a+n));a=a+n;const l=s.decode(e.slice(a,a+i));a=a+i;const c=JSON.parse(s.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:l,payload:c}}}class Us{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var I;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(I||(I={}));const ls=(r,e,t={})=>{var s;const n=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((i,a)=>(i[a]=En(a,r,e,n),i),{})},En=(r,e,t,s)=>{const n=e.find(o=>o.name===r),i=n==null?void 0:n.type,a=t[r];return i&&!s.includes(i)?Ls(i,a):Nt(a)},Ls=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return Pn(e,t)}switch(r){case I.bool:return Tn(e);case I.float4:case I.float8:case I.int2:case I.int4:case I.int8:case I.numeric:case I.oid:return An(e);case I.json:case I.jsonb:return On(e);case I.timestamp:return Cn(e);case I.abstime:case I.date:case I.daterange:case I.int4range:case I.int8range:case I.money:case I.reltime:case I.text:case I.time:case I.timestamptz:case I.timetz:case I.tsrange:case I.tstzrange:return Nt(e);default:return Nt(e)}},Nt=r=>r,Tn=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},An=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},On=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch{return r}return r},Pn=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let i;const a=r.slice(1,t);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(o=>Ls(e,o))}return r},Cn=r=>typeof r=="string"?r.replace(" ","T"):r,Ds=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class kt{constructor(e,t,s={},n=Rt){this.channel=e,this.event=t,this.payload=s,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var cs;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(cs||(cs={}));class Ve{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},n=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ve.syncState(this.state,n,i,a),this.pendingDiffs.forEach(l=>{this.state=Ve.syncDiff(this.state,l,i,a)}),this.pendingDiffs=[],o()}),this.channel._on(s.diff,{},n=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=Ve.syncDiff(this.state,n,i,a),o())}),this.onJoin((n,i,a)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:a})}),this.onLeave((n,i,a)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,n){const i=this.cloneDeep(e),a=this.transformState(t),o={},l={};return this.map(i,(c,d)=>{a[c]||(l[c]=d)}),this.map(a,(c,d)=>{const f=i[c];if(f){const u=d.map(y=>y.presence_ref),g=f.map(y=>y.presence_ref),p=d.filter(y=>g.indexOf(y.presence_ref)<0),v=f.filter(y=>u.indexOf(y.presence_ref)<0);p.length>0&&(o[c]=p),v.length>0&&(l[c]=v)}else o[c]=d}),this.syncDiff(i,{joins:o,leaves:l},s,n)}static syncDiff(e,t,s,n){const{joins:i,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),n||(n=()=>{}),this.map(i,(o,l)=>{var c;const d=(c=e[o])!==null&&c!==void 0?c:[];if(e[o]=this.cloneDeep(l),d.length>0){const f=e[o].map(g=>g.presence_ref),u=d.filter(g=>f.indexOf(g.presence_ref)<0);e[o].unshift(...u)}s(o,d,l)}),this.map(a,(o,l)=>{let c=e[o];if(!c)return;const d=l.map(f=>f.presence_ref);c=c.filter(f=>d.indexOf(f.presence_ref)<0),e[o]=c,n(o,c,l),c.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const n=e[s];return"metas"in n?t[s]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[s]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var ds;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(ds||(ds={}));var Ge;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(Ge||(Ge={}));var he;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(he||(he={}));class Ht{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=q.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new kt(this,se.join,this.params,this.timeout),this.rejoinTimer=new Us(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=q.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=q.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=q.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=q.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=q.errored,this.rejoinTimer.scheduleTimeout())}),this._on(se.reply,{},(n,i)=>{this._trigger(this._replyEventName(i),n)}),this.presence=new Ve(this),this.broadcastEndpointURL=Ds(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,n;if(this.socket.isConnected()||this.socket.connect(),this.state==q.closed){const{config:{broadcast:i,presence:a,private:o}}=this.params,l=(n=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(u=>u.filter))!==null&&n!==void 0?n:[],c=!!this.bindings[Ge.PRESENCE]&&this.bindings[Ge.PRESENCE].length>0,d={},f={broadcast:i,presence:Object.assign(Object.assign({},a),{enabled:c}),postgres_changes:l,private:o};this.socket.accessTokenValue&&(d.access_token=this.socket.accessTokenValue),this._onError(u=>e==null?void 0:e(he.CHANNEL_ERROR,u)),this._onClose(()=>e==null?void 0:e(he.CLOSED)),this.updateJoinPayload(Object.assign({config:f},d)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:u})=>{var g;if(this.socket.setAuth(),u===void 0){e==null||e(he.SUBSCRIBED);return}else{const p=this.bindings.postgres_changes,v=(g=p==null?void 0:p.length)!==null&&g!==void 0?g:0,y=[];for(let S=0;S<v;S++){const A=p[S],{filter:{event:w,schema:x,table:_,filter:b}}=A,O=u&&u[S];if(O&&O.event===w&&O.schema===x&&O.table===_&&O.filter===b)y.push(Object.assign(Object.assign({},A),{id:O.id}));else{this.unsubscribe(),this.state=q.errored,e==null||e(he.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,e&&e(he.SUBSCRIBED);return}}).receive("error",u=>{this.state=q.errored,e==null||e(he.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(he.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this.state===q.joined&&e===Ge.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,s)}async send(e,t={}){var s,n;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:a}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((n=c.body)===null||n===void 0?void 0:n.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,o,l;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),c.receive("ok",()=>i("ok")),c.receive("error",()=>i("error")),c.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=q.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(se.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(n=>{s=new kt(this,se.leave,{},e),s.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s==null||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=q.closed,this.bindings={}}async _fetchWithTimeout(e,t,s){const n=new AbortController,i=setTimeout(()=>n.abort(),s),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),a}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new kt(this,e,t,s);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>Sn){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var n,i;const a=e.toLocaleLowerCase(),{close:o,error:l,leave:c,join:d}=se;if(s&&[o,l,c,d].indexOf(a)>=0&&s!==this._joinRef())return;let u=this._onMessage(a,t,s);if(t&&!u)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(g=>{var p,v,y;return((p=g.filter)===null||p===void 0?void 0:p.event)==="*"||((y=(v=g.filter)===null||v===void 0?void 0:v.event)===null||y===void 0?void 0:y.toLocaleLowerCase())===a}).map(g=>g.callback(u,s)):(i=this.bindings[a])===null||i===void 0||i.filter(g=>{var p,v,y,S,A,w;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in g){const x=g.id,_=(p=g.filter)===null||p===void 0?void 0:p.event;return x&&((v=t.ids)===null||v===void 0?void 0:v.includes(x))&&(_==="*"||(_==null?void 0:_.toLocaleLowerCase())===((y=t.data)===null||y===void 0?void 0:y.type.toLocaleLowerCase()))}else{const x=(A=(S=g==null?void 0:g.filter)===null||S===void 0?void 0:S.event)===null||A===void 0?void 0:A.toLocaleLowerCase();return x==="*"||x===((w=t==null?void 0:t.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===a}).map(g=>{if(typeof u=="object"&&"ids"in u){const p=u.data,{schema:v,table:y,commit_timestamp:S,type:A,errors:w}=p;u=Object.assign(Object.assign({},{schema:v,table:y,commit_timestamp:S,eventType:A,new:{},old:{},errors:w}),this._getPayloadRecords(p))}g.callback(u,s)})}_isClosed(){return this.state===q.closed}_isJoined(){return this.state===q.joined}_isJoining(){return this.state===q.joining}_isLeaving(){return this.state===q.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:s};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&Ht.isEqual(n.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(se.close,{},e)}_onError(e){this._on(se.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=q.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=ls(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=ls(e.columns,e.old_record)),t}}const us=()=>{},rt={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},$n=[1e3,2e3,5e3,1e4],Rn=1e4,In=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Nn{constructor(e,t){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Rt,this.transport=null,this.heartbeatIntervalMs=rt.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=us,this.ref=0,this.reconnectTimer=null,this.logger=us,this.conn=null,this.sendBuffer=[],this.serializer=new jn,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=n=>{let i;return n?i=n:typeof fetch>"u"?i=(...a)=>Qe(async()=>{const{default:o}=await Promise.resolve().then(()=>De);return{default:o}},void 0).then(({default:o})=>o(...a)).catch(o=>{throw new Error(`Failed to load @supabase/node-fetch: ${o.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):i=fetch,(...a)=>i(...a)},!(!((s=t==null?void 0:t.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${It.websocket}`,this.httpEndpoint=Ds(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=wn.createWebSocket(this.endpointURL())}catch(e){throw this._setConnectionState("disconnected"),new Error(`WebSocket not available: ${e.message}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:xn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Je.connecting:return ke.Connecting;case Je.open:return ke.Open;case Je.closing:return ke.Closing;default:return ke.Closed}}isConnected(){return this.connectionState()===ke.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const s=`realtime:${e}`,n=this.getChannels().find(i=>i.topic===s);if(n)return n;{const i=new Ht(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:s,payload:n,ref:i}=e,a=()=>{this.encode(e,o=>{var l;(l=this.conn)===null||l===void 0||l.send(o)})};this.log("push",`${t} ${s} (${i})`,n),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(kn,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},rt.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{t.topic==="phoenix"&&t.event==="phx_reply"&&this.heartbeatCallback(t.payload.status==="ok"?"ok":"error"),t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:s,event:n,payload:i,ref:a}=t,o=a?`(${a})`:"",l=i.status||"";this.log("receive",`${l} ${s} ${n} ${o}`.trim(),i),this.channels.filter(c=>c._isMember(s)).forEach(c=>c._trigger(n,i,a)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(se.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${s}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([In],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(s=>{const n={access_token:t,version:_n};t&&s.updateJoinPayload(n),s.joinedOnce&&s._isJoined()&&s._push(se.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(t)}catch(n){this.log("error",`error in ${e} callback`,n)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new Us(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},rt.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,s,n,i,a,o,l,c;if(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(s=e==null?void 0:e.timeout)!==null&&s!==void 0?s:Rt,this.heartbeatIntervalMs=(n=e==null?void 0:e.heartbeatIntervalMs)!==null&&n!==void 0?n:rt.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(a=e==null?void 0:e.accessToken)!==null&&a!==void 0?a:null,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(o=e==null?void 0:e.reconnectAfterMs)!==null&&o!==void 0?o:d=>$n[d-1]||Rn,this.encode=(l=e==null?void 0:e.encode)!==null&&l!==void 0?l:(d,f)=>f(JSON.stringify(d)),this.decode=(c=e==null?void 0:e.decode)!==null&&c!==void 0?c:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class Kt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function F(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class Un extends Kt{constructor(e,t,s){super(e),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Ut extends Kt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Ln=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(d){try{c(s.next(d))}catch(f){a(f)}}function l(d){try{c(s.throw(d))}catch(f){a(f)}}function c(d){d.done?i(d.value):n(d.value).then(o,l)}c((s=s.apply(r,e||[])).next())})};const Bs=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Qe(async()=>{const{default:s}=await Promise.resolve().then(()=>De);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Dn=()=>Ln(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Qe(()=>Promise.resolve().then(()=>De),void 0)).Response:Response}),Lt=r=>{if(Array.isArray(r))return r.map(t=>Lt(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,s])=>{const n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=Lt(s)}),e},Bn=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)};var Se=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(d){try{c(s.next(d))}catch(f){a(f)}}function l(d){try{c(s.throw(d))}catch(f){a(f)}}function c(d){d.done?i(d.value):n(d.value).then(o,l)}c((s=s.apply(r,e||[])).next())})};const St=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Mn=(r,e,t)=>Se(void 0,void 0,void 0,function*(){const s=yield Dn();r instanceof s&&!(t!=null&&t.noResolveJson)?r.json().then(n=>{const i=r.status||500,a=(n==null?void 0:n.statusCode)||i+"";e(new Un(St(n),i,a))}).catch(n=>{e(new Ut(St(n),n))}):e(new Ut(St(r),r))}),qn=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"||!s?n:(Bn(s)?(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),n.body=JSON.stringify(s)):n.body=s,Object.assign(Object.assign({},n),t))};function Ze(r,e,t,s,n,i){return Se(this,void 0,void 0,function*(){return new Promise((a,o)=>{r(t,qn(e,s,n,i)).then(l=>{if(!l.ok)throw l;return s!=null&&s.noResolveJson?l:l.json()}).then(l=>a(l)).catch(l=>Mn(l,o,s))})})}function lt(r,e,t,s){return Se(this,void 0,void 0,function*(){return Ze(r,"GET",e,t,s)})}function fe(r,e,t,s,n){return Se(this,void 0,void 0,function*(){return Ze(r,"POST",e,s,n,t)})}function Dt(r,e,t,s,n){return Se(this,void 0,void 0,function*(){return Ze(r,"PUT",e,s,n,t)})}function zn(r,e,t,s){return Se(this,void 0,void 0,function*(){return Ze(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function Ms(r,e,t,s,n){return Se(this,void 0,void 0,function*(){return Ze(r,"DELETE",e,s,n,t)})}var K=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(d){try{c(s.next(d))}catch(f){a(f)}}function l(d){try{c(s.throw(d))}catch(f){a(f)}}function c(d){d.done?i(d.value):n(d.value).then(o,l)}c((s=s.apply(r,e||[])).next())})};const Fn={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},hs={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Wn{constructor(e,t={},s,n){this.url=e,this.headers=t,this.bucketId=s,this.fetch=Bs(n)}uploadOrUpdate(e,t,s,n){return K(this,void 0,void 0,function*(){try{let i;const a=Object.assign(Object.assign({},hs),n);let o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const l=a.metadata;typeof Blob<"u"&&s instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",s)):typeof FormData<"u"&&s instanceof FormData?(i=s,i.append("cacheControl",a.cacheControl),l&&i.append("metadata",this.encodeMetadata(l))):(i=s,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,l&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),n!=null&&n.headers&&(o=Object.assign(Object.assign({},o),n.headers));const c=this._removeEmptyFolders(t),d=this._getFinalPath(c),f=yield(e=="PUT"?Dt:fe)(this.fetch,`${this.url}/object/${d}`,i,Object.assign({headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{}));return{data:{path:c,id:f.Id,fullPath:f.Key},error:null}}catch(i){if(F(i))return{data:null,error:i};throw i}})}upload(e,t,s){return K(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,n){return K(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),a=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let l;const c=Object.assign({upsert:hs.upsert},n),d=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&s instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",s)):typeof FormData<"u"&&s instanceof FormData?(l=s,l.append("cacheControl",c.cacheControl)):(l=s,d["cache-control"]=`max-age=${c.cacheControl}`,d["content-type"]=c.contentType);const f=yield Dt(this.fetch,o.toString(),l,{headers:d});return{data:{path:i,fullPath:f.Key},error:null}}catch(l){if(F(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return K(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const n=Object.assign({},this.headers);t!=null&&t.upsert&&(n["x-upsert"]="true");const i=yield fe(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:n}),a=new URL(this.url+i.url),o=a.searchParams.get("token");if(!o)throw new Kt("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:o},error:null}}catch(s){if(F(s))return{data:null,error:s};throw s}})}update(e,t,s){return K(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return K(this,void 0,void 0,function*(){try{return{data:yield fe(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(F(n))return{data:null,error:n};throw n}})}copy(e,t,s){return K(this,void 0,void 0,function*(){try{return{data:{path:(yield fe(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(F(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,s){return K(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield fe(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const a=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(n){if(F(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,s){return K(this,void 0,void 0,function*(){try{const n=yield fe(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:n.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(n){if(F(n))return{data:null,error:n};throw n}})}download(e,t){return K(this,void 0,void 0,function*(){const n=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=i?`?${i}`:"";try{const o=this._getFinalPath(e);return{data:yield(yield lt(this.fetch,`${this.url}/${n}/${o}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(F(o))return{data:null,error:o};throw o}})}info(e){return K(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield lt(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Lt(s),error:null}}catch(s){if(F(s))return{data:null,error:s};throw s}})}exists(e){return K(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield zn(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(F(s)&&s instanceof Ut){const n=s.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),n=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);const o=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&n.push(l);let c=n.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${s}${c}`)}}}remove(e){return K(this,void 0,void 0,function*(){try{return{data:yield Ms(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(F(t))return{data:null,error:t};throw t}})}list(e,t,s){return K(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},Fn),t),{prefix:e||""});return{data:yield fe(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},s),error:null}}catch(n){if(F(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Hn="2.10.4",Kn={"X-Client-Info":`storage-js/${Hn}`};var Pe=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(d){try{c(s.next(d))}catch(f){a(f)}}function l(d){try{c(s.throw(d))}catch(f){a(f)}}function c(d){d.done?i(d.value):n(d.value).then(o,l)}c((s=s.apply(r,e||[])).next())})};class Jn{constructor(e,t={},s,n){const i=new URL(e);n!=null&&n.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href,this.headers=Object.assign(Object.assign({},Kn),t),this.fetch=Bs(s)}listBuckets(){return Pe(this,void 0,void 0,function*(){try{return{data:yield lt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(F(e))return{data:null,error:e};throw e}})}getBucket(e){return Pe(this,void 0,void 0,function*(){try{return{data:yield lt(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(F(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Pe(this,void 0,void 0,function*(){try{return{data:yield fe(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(F(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return Pe(this,void 0,void 0,function*(){try{return{data:yield Dt(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(F(s))return{data:null,error:s};throw s}})}emptyBucket(e){return Pe(this,void 0,void 0,function*(){try{return{data:yield fe(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(F(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Pe(this,void 0,void 0,function*(){try{return{data:yield Ms(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(F(t))return{data:null,error:t};throw t}})}}class Vn extends Jn{constructor(e,t={},s,n){super(e,t,s,n)}from(e){return new Wn(this.url,this.headers,e,this.fetch)}}const Gn="2.54.0";let Ke="";typeof Deno<"u"?Ke="deno":typeof document<"u"?Ke="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ke="react-native":Ke="node";const Yn={"X-Client-Info":`supabase-js-${Ke}/${Gn}`},Qn={headers:Yn},Xn={schema:"public"},Zn={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ei={};var ti=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(d){try{c(s.next(d))}catch(f){a(f)}}function l(d){try{c(s.throw(d))}catch(f){a(f)}}function c(d){d.done?i(d.value):n(d.value).then(o,l)}c((s=s.apply(r,e||[])).next())})};const si=r=>{let e;return r?e=r:typeof fetch>"u"?e=js:e=fetch,(...t)=>e(...t)},ri=()=>typeof Headers>"u"?Es:Headers,ni=(r,e,t)=>{const s=si(t),n=ri();return(i,a)=>ti(void 0,void 0,void 0,function*(){var o;const l=(o=yield e())!==null&&o!==void 0?o:r;let c=new n(a==null?void 0:a.headers);return c.has("apikey")||c.set("apikey",r),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),s(i,Object.assign(Object.assign({},a),{headers:c}))})};var ii=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(d){try{c(s.next(d))}catch(f){a(f)}}function l(d){try{c(s.throw(d))}catch(f){a(f)}}function c(d){d.done?i(d.value):n(d.value).then(o,l)}c((s=s.apply(r,e||[])).next())})};function ai(r){return r.endsWith("/")?r:r+"/"}function oi(r,e){var t,s;const{db:n,auth:i,realtime:a,global:o}=r,{db:l,auth:c,realtime:d,global:f}=e,u={db:Object.assign(Object.assign({},l),n),auth:Object.assign(Object.assign({},c),i),realtime:Object.assign(Object.assign({},d),a),storage:{},global:Object.assign(Object.assign(Object.assign({},f),o),{headers:Object.assign(Object.assign({},(t=f==null?void 0:f.headers)!==null&&t!==void 0?t:{}),(s=o==null?void 0:o.headers)!==null&&s!==void 0?s:{})}),accessToken:()=>ii(this,void 0,void 0,function*(){return""})};return r.accessToken?u.accessToken=r.accessToken:delete u.accessToken,u}const qs="2.71.1",Ne=30*1e3,Bt=3,jt=Bt*Ne,li="http://localhost:9999",ci="supabase.auth.token",di={"X-Client-Info":`gotrue-js/${qs}`},Mt="X-Supabase-Api-Version",zs={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},ui=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,hi=10*60*1e3;class Jt extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function E(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class fi extends Jt{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function gi(r){return E(r)&&r.name==="AuthApiError"}class Fs extends Jt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class ye extends Jt{constructor(e,t,s,n){super(e,s,n),this.name=t,this.status=s}}class me extends ye{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function pi(r){return E(r)&&r.name==="AuthSessionMissingError"}class nt extends ye{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class it extends ye{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class at extends ye{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function mi(r){return E(r)&&r.name==="AuthImplicitGrantRedirectError"}class fs extends ye{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class qt extends ye{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Et(r){return E(r)&&r.name==="AuthRetryableFetchError"}class gs extends ye{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class zt extends ye{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const ct="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),ps=` 	
\r=`.split(""),vi=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<ps.length;e+=1)r[ps[e].charCodeAt(0)]=-2;for(let e=0;e<ct.length;e+=1)r[ct[e].charCodeAt(0)]=e;return r})();function ms(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(ct[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(ct[s]),e.queuedBits-=6}}function Ws(r,e,t){const s=vi[r];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function vs(r){const e=[],t=a=>{e.push(String.fromCodePoint(a))},s={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=a=>{bi(a,s,t)};for(let a=0;a<r.length;a+=1)Ws(r.charCodeAt(a),n,i);return e.join("")}function yi(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function wi(r,e){for(let t=0;t<r.length;t+=1){let s=r.charCodeAt(t);if(s>55295&&s<=56319){const n=(s-55296)*1024&65535;s=(r.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}yi(s,e)}}function bi(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let s=1;s<6;s+=1)if(!(r>>7-s&1)){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function _i(r){const e=[],t={queue:0,queuedBits:0},s=n=>{e.push(n)};for(let n=0;n<r.length;n+=1)Ws(r.charCodeAt(n),t,s);return new Uint8Array(e)}function xi(r){const e=[];return wi(r,t=>e.push(t)),new Uint8Array(e)}function ki(r){const e=[],t={queue:0,queuedBits:0},s=n=>{e.push(n)};return r.forEach(n=>ms(n,t,s)),ms(null,t,s),e.join("")}function Si(r){return Math.round(Date.now()/1e3)+r}function ji(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const te=()=>typeof window<"u"&&typeof document<"u",be={tested:!1,writable:!1},Hs=()=>{if(!te())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(be.tested)return be.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),be.tested=!0,be.writable=!0}catch{be.tested=!0,be.writable=!1}return be.writable};function Ei(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return t.searchParams.forEach((s,n)=>{e[n]=s}),e}const Ks=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Qe(async()=>{const{default:s}=await Promise.resolve().then(()=>De);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Ti=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",Ue=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},_e=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},pe=async(r,e)=>{await r.removeItem(e)};class mt{constructor(){this.promise=new mt.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}mt.promiseConstructor=Promise;function Tt(r){const e=r.split(".");if(e.length!==3)throw new zt("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!ui.test(e[s]))throw new zt("JWT not in base64url format");return{header:JSON.parse(vs(e[0])),payload:JSON.parse(vs(e[1])),signature:_i(e[2]),raw:{header:e[0],payload:e[1]}}}async function Ai(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function Oi(r,e){return new Promise((s,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await r(i);if(!e(i,null,a)){s(a);return}}catch(a){if(!e(i,a)){n(a);return}}})()})}function Pi(r){return("0"+r.toString(16)).substr(-2)}function Ci(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*s));return n}return crypto.getRandomValues(e),Array.from(e,Pi).join("")}async function $i(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(s);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}async function Ri(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return r;const t=await $i(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ce(r,e,t=!1){const s=Ci();let n=s;t&&(n+="/PASSWORD_RECOVERY"),await Ue(r,`${e}-code-verifier`,n);const i=await Ri(s);return[i,s===i?"plain":"s256"]}const Ii=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Ni(r){const e=r.headers.get(Mt);if(!e||!e.match(Ii))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Ui(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function Li(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Di=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function $e(r){if(!Di.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function At(){const r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const s=t.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function ys(r){return JSON.parse(JSON.stringify(r))}var Bi=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};const xe=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Mi=[502,503,504];async function ws(r){var e;if(!Ti(r))throw new qt(xe(r),0);if(Mi.includes(r.status))throw new qt(xe(r),r.status);let t;try{t=await r.json()}catch(i){throw new Fs(xe(i),i)}let s;const n=Ni(r);if(n&&n.getTime()>=zs["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new gs(xe(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new me}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0))throw new gs(xe(t),r.status,t.weak_password.reasons);throw new fi(xe(t),r.status||500,s)}const qi=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),t))};async function P(r,e,t,s){var n;const i=Object.assign({},s==null?void 0:s.headers);i[Mt]||(i[Mt]=zs["2024-01-01"].name),s!=null&&s.jwt&&(i.Authorization=`Bearer ${s.jwt}`);const a=(n=s==null?void 0:s.query)!==null&&n!==void 0?n:{};s!=null&&s.redirectTo&&(a.redirect_to=s.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await zi(r,e,t+o,{headers:i,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(l):{data:Object.assign({},l),error:null}}async function zi(r,e,t,s,n,i){const a=qi(e,s,n,i);let o;try{o=await r(t,Object.assign({},a))}catch(l){throw new qt(xe(l),0)}if(o.ok||await ws(o),s!=null&&s.noResolveJson)return o;try{return await o.json()}catch(l){await ws(l)}}function ue(r){var e;let t=null;Ki(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=Si(r.expires_in)));const s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function bs(r){const e=ue(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function ve(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function Fi(r){return{data:r,error:null}}function Wi(r){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i}=r,a=Bi(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i},l=Object.assign({},a);return{data:{properties:o,user:l},error:null}}function Hi(r){return r}function Ki(r){return r.access_token&&r.refresh_token&&r.expires_in}const Ot=["global","local","others"];var Ji=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};class Vi{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Ks(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=Ot[0]){if(Ot.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Ot.join(", ")}`);try{return await P(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(E(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await P(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ve})}catch(s){if(E(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=Ji(e,["options"]),n=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(n.new_email=s==null?void 0:s.newEmail,delete n.newEmail),await P(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Wi,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(E(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await P(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ve})}catch(t){if(E(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,n,i,a,o,l;try{const c={nextPage:null,lastPage:0,total:0},d=await P(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:Hi});if(d.error)throw d.error;const f=await d.json(),u=(a=d.headers.get("x-total-count"))!==null&&a!==void 0?a:0,g=(l=(o=d.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return g.length>0&&(g.forEach(p=>{const v=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),y=JSON.parse(p.split(";")[1].split("=")[1]);c[`${y}Page`]=v}),c.total=parseInt(u)),{data:Object.assign(Object.assign({},f),c),error:null}}catch(c){if(E(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){$e(e);try{return await P(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ve})}catch(t){if(E(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){$e(e);try{return await P(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ve})}catch(s){if(E(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){$e(e);try{return await P(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:ve})}catch(s){if(E(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){$e(e.userId);try{const{data:t,error:s}=await P(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:s}}catch(t){if(E(t))return{data:null,error:t};throw t}}async _deleteFactor(e){$e(e.userId),$e(e.id);try{return{data:await P(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(E(t))return{data:null,error:t};throw t}}}function _s(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function Gi(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Re={debug:!!(globalThis&&Hs()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Js extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Yi extends Js{}async function Qi(r,e,t){Re.debug;const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),Re.debug},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async n=>{if(n){Re.debug;try{return await t()}finally{Re.debug}}else{if(e===0)throw Re.debug,new Yi(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(Re.debug)try{const i=await globalThis.navigator.locks.query()}catch{}return await t()}}))}Gi();const Xi={url:li,storageKey:ci,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:di,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function xs(r,e,t){return await t()}const Ie={};class Ye{constructor(e){var t,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Ye.nextInstanceID,Ye.nextInstanceID+=1,this.instanceID>0&&te();const n=Object.assign(Object.assign({},Xi),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new Vi({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=Ks(n.fetch),this.lock=n.lock||xs,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:te()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=Qi:this.lock=xs,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(n.storage?this.storage=n.storage:Hs()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=_s(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=_s(this.memoryStorage)),te()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch{}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=Ie[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Ie[this.storageKey]=Object.assign(Object.assign({},Ie[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Ie[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Ie[this.storageKey]=Object.assign(Object.assign({},Ie[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${qs}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Ei(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),te()&&this.detectSessionInUrl&&s!=="none"){const{data:n,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),mi(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:a,redirectType:o}=n;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return E(t)?{error:t}:{error:new Fs("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,n;try{const i=await P(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:ue}),{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(i){if(E(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,s,n;try{let i;if("email"in e){const{email:d,password:f,options:u}=e;let g=null,p=null;this.flowType==="pkce"&&([g,p]=await Ce(this.storage,this.storageKey)),i=await P(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:u==null?void 0:u.emailRedirectTo,body:{email:d,password:f,data:(t=u==null?void 0:u.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken},code_challenge:g,code_challenge_method:p},xform:ue})}else if("phone"in e){const{phone:d,password:f,options:u}=e;i=await P(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:f,data:(s=u==null?void 0:u.data)!==null&&s!==void 0?s:{},channel:(n=u==null?void 0:u.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}},xform:ue})}else throw new it("You must provide either an email or phone number and a password");const{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(i){if(E(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:a,options:o}=e;t=await P(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:bs})}else if("phone"in e){const{phone:i,password:a,options:o}=e;t=await P(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:bs})}else throw new it("You must provide either an email or phone number and a password");const{data:s,error:n}=t;return n?{data:{user:null,session:null},error:n}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new nt}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:n})}catch(t){if(E(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,s,n,i,a,o,l,c,d,f,u,g;let p,v;if("message"in e)p=e.message,v=e.signature;else{const{chain:y,wallet:S,statement:A,options:w}=e;let x;if(te())if(typeof S=="object")x=S;else{const b=window;if("solana"in b&&typeof b.solana=="object"&&("signIn"in b.solana&&typeof b.solana.signIn=="function"||"signMessage"in b.solana&&typeof b.solana.signMessage=="function"))x=b.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof S!="object"||!(w!=null&&w.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");x=S}const _=new URL((t=w==null?void 0:w.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in x&&x.signIn){const b=await x.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w==null?void 0:w.signInWithSolana),{version:"1",domain:_.host,uri:_.href}),A?{statement:A}:null));let O;if(Array.isArray(b)&&b[0]&&typeof b[0]=="object")O=b[0];else if(b&&typeof b=="object"&&"signedMessage"in b&&"signature"in b)O=b;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in O&&"signature"in O&&(typeof O.signedMessage=="string"||O.signedMessage instanceof Uint8Array)&&O.signature instanceof Uint8Array)p=typeof O.signedMessage=="string"?O.signedMessage:new TextDecoder().decode(O.signedMessage),v=O.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in x)||typeof x.signMessage!="function"||!("publicKey"in x)||typeof x!="object"||!x.publicKey||!("toBase58"in x.publicKey)||typeof x.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");p=[`${_.host} wants you to sign in with your Solana account:`,x.publicKey.toBase58(),...A?["",A,""]:[""],"Version: 1",`URI: ${_.href}`,`Issued At: ${(n=(s=w==null?void 0:w.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((i=w==null?void 0:w.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((a=w==null?void 0:w.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((o=w==null?void 0:w.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((l=w==null?void 0:w.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((c=w==null?void 0:w.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((f=(d=w==null?void 0:w.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||f===void 0)&&f.length?["Resources",...w.signInWithSolana.resources.map(O=>`- ${O}`)]:[]].join(`
`);const b=await x.signMessage(new TextEncoder().encode(p),"utf8");if(!b||!(b instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");v=b}}try{const{data:y,error:S}=await P(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:p,signature:ki(v)},!((u=e.options)===null||u===void 0)&&u.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:ue});if(S)throw S;return!y||!y.session||!y.user?{data:{user:null,session:null},error:new nt}:(y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),{data:Object.assign({},y),error:S})}catch(y){if(E(y))return{data:{user:null,session:null},error:y};throw y}}async _exchangeCodeForSession(e){const t=await _e(this.storage,`${this.storageKey}-code-verifier`),[s,n]=(t??"").split("/");try{const{data:i,error:a}=await P(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:ue});if(await pe(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new nt}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:a})}catch(i){if(E(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:s,token:n,access_token:i,nonce:a}=e,o=await P(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:n,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:ue}),{data:l,error:c}=o;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new nt}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(t){if(E(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,n,i,a;try{if("email"in e){const{email:o,options:l}=e;let c=null,d=null;this.flowType==="pkce"&&([c,d]=await Ce(this.storage,this.storageKey));const{error:f}=await P(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(s=l==null?void 0:l.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:d},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:f}}if("phone"in e){const{phone:o,options:l}=e,{data:c,error:d}=await P(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(n=l==null?void 0:l.data)!==null&&n!==void 0?n:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(a=l==null?void 0:l.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:d}}throw new it("You must provide either an email or phone number.")}catch(o){if(E(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,s;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:a,error:o}=await P(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:ue});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const l=a.session,c=a.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(n){if(E(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,s,n;try{let i=null,a=null;return this.flowType==="pkce"&&([i,a]=await Ce(this.storage,this.storageKey)),await P(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:a}),headers:this.headers,xform:Fi})}catch(i){if(E(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new me;const{error:n}=await P(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(E(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:n,options:i}=e,{error:a}=await P(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:s,type:n,options:i}=e,{data:a,error:o}=await P(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o}}throw new it("You must provide either an email or phone number and a type")}catch(t){if(E(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await _e(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<jt:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const a=await _e(this.userStorage,this.storageKey+"-user");a!=null&&a.user?e.user=a.user:e.user=At()}if(this.storage.isServer&&e.user){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,d)=>(!a&&c==="user"&&(a=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,d))})}return{data:{session:e},error:null}}const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await P(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ve}):await this._useSession(async t=>{var s,n,i;const{data:a,error:o}=t;if(o)throw o;return!(!((s=a.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new me}:await P(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=a.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:ve})})}catch(t){if(E(t))return pi(t)&&(await this._removeSession(),await pe(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:n,error:i}=s;if(i)throw i;if(!n.session)throw new me;const a=n.session;let o=null,l=null;this.flowType==="pkce"&&e.email!=null&&([o,l]=await Ce(this.storage,this.storageKey));const{data:c,error:d}=await P(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:l}),jwt:a.access_token,xform:ve});if(d)throw d;return a.user=c.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(s){if(E(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new me;const t=Date.now()/1e3;let s=t,n=!0,i=null;const{payload:a}=Tt(e.access_token);if(a.exp&&(s=a.exp,n=s<=t),n){const{session:o,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(E(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(s=a.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new me;const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(E(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!te())throw new at("No browser detected.");if(e.error||e.error_description||e.error_code)throw new at(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new fs("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new at("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new fs("No code detected.");const{data:A,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const x=new URL(window.location.href);return x.searchParams.delete("code"),window.history.replaceState(window.history.state,"",x.toString()),{data:{session:A.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:n,access_token:i,refresh_token:a,expires_in:o,expires_at:l,token_type:c}=e;if(!i||!o||!a||!c)throw new at("No session defined in URL");const d=Math.round(Date.now()/1e3),f=parseInt(o);let u=d+f;l&&(u=parseInt(l)),(u-d)*1e3<=Ne;const p=u-f;d-p>=120||d-p<0;const{data:v,error:y}=await this._getUser(i);if(y)throw y;const S={provider_token:s,provider_refresh_token:n,access_token:i,expires_in:f,expires_at:u,refresh_token:a,token_type:c,user:v.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:S,redirectType:e.type},error:null}}catch(s){if(E(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await _e(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{error:i};const a=(s=n.session)===null||s===void 0?void 0:s.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(gi(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return e!=="others"&&(await this._removeSession(),await pe(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=ji(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,n;try{const{data:{session:i},error:a}=t;if(a)throw a;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i)}})}async resetPasswordForEmail(e,t={}){let s=null,n=null;this.flowType==="pkce"&&([s,n]=await Ce(this.storage,this.storageKey,!0));try{return await P(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(E(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(E(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:n}=await this._useSession(async i=>{var a,o,l,c,d;const{data:f,error:u}=i;if(u)throw u;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await P(this.fetch,"GET",g,{headers:this.headers,jwt:(d=(c=f.session)===null||c===void 0?void 0:c.access_token)!==null&&d!==void 0?d:void 0})});if(n)throw n;return te()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(E(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:a}=t;if(a)throw a;return await P(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(E(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await Oi(async n=>(n>0&&await Ai(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await P(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ue})),(n,i)=>{const a=200*Math.pow(2,n);return i&&Et(i)&&Date.now()+a-s<Ne})}catch(s){if(this._debug(t,"error",s),E(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),te()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const n=await _e(this.storage,this.storageKey);if(n&&this.userStorage){let a=await _e(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:n.user},await Ue(this.userStorage,this.storageKey+"-user",a)),n.user=(e=a==null?void 0:a.user)!==null&&e!==void 0?e:At()}else if(n&&!n.user&&!n.user){const a=await _e(this.storage,this.storageKey+"-user");a&&(a!=null&&a.user)?(n.user=a.user,await pe(this.storage,this.storageKey+"-user"),await Ue(this.storage,this.storageKey,n)):n.user=At()}if(this._debug(s,"session from storage",n),!this._isValidSession(n)){this._debug(s,"session is not valid"),n!==null&&await this._removeSession();return}const i=((t=n.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<jt;if(this._debug(s,`session has${i?"":" not"} expired with margin of ${jt}s`),i){if(this.autoRefreshToken&&n.refresh_token){const{error:a}=await this._callRefreshToken(n.refresh_token);a&&(Et(a)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:a,error:o}=await this._getUser(n.access_token);!o&&(a!=null&&a.user)?(n.user=a.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(a){this._debug(s,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(s,"error",n);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new me;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new mt;const{data:i,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!i.session)throw new me;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={session:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(n,"error",i),E(i)){const a={session:null,error:i};return Et(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,s=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(l){i.push(l)}});if(await Promise.all(a),i.length>0){for(let o=0;o<i.length;o+=1);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),s=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&t.user&&await Ue(this.userStorage,this.storageKey+"-user",{user:t.user});const n=Object.assign({},t);delete n.user;const i=ys(n);await Ue(this.storage,this.storageKey,i)}else{const n=ys(t);await Ue(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),await pe(this.storage,this.storageKey),await pe(this.storage,this.storageKey+"-code-verifier"),await pe(this.storage,this.storageKey+"-user"),this.userStorage&&await pe(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&te()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch{}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ne);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((s.expires_at*1e3-e)/Ne);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${Ne}ms, refresh threshold is ${Bt} ticks`),n<=Bt&&await this._callRefreshToken(s.refresh_token)})}catch{}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Js)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!te()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch{}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const n=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&n.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&n.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[i,a]=await Ce(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});n.push(o.toString())}if(s!=null&&s.queryParams){const i=new URLSearchParams(s.queryParams);n.push(i.toString())}return s!=null&&s.skipBrowserRedirect&&n.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?{data:null,error:i}:await P(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(E(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:a}=t;if(a)return{data:null,error:a};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await P(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((n=l==null?void 0:l.totp)===null||n===void 0)&&n.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if(E(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{data:null,error:i};const{data:a,error:o}=await P(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if(E(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?{data:null,error:i}:await P(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(E(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(e==null?void 0:e.factors)||[],n=s.filter(a=>a.factor_type==="totp"&&a.status==="verified"),i=s.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:s,totp:n,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:n},error:i}=e;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=Tt(n.access_token);let o=null;a.aal&&(o=a.aal);let l=o;((s=(t=n.user.factors)===null||t===void 0?void 0:t.filter(f=>f.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(l="aal2");const d=a.amr||[];return{data:{currentLevel:o,nextLevel:l,currentAuthenticationMethods:d},error:null}}))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(o=>o.kid===e);if(s)return s;const n=Date.now();if(s=this.jwks.keys.find(o=>o.kid===e),s&&this.jwks_cached_at+hi>n)return s;const{data:i,error:a}=await P(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=n,s=i.keys.find(o=>o.kid===e),!s)?null:s}async getClaims(e,t={}){try{let s=e;if(!s){const{data:g,error:p}=await this.getSession();if(p||!g.session)return{data:null,error:p};s=g.session.access_token}const{header:n,payload:i,signature:a,raw:{header:o,payload:l}}=Tt(s);t!=null&&t.allowExpired||Ui(i.exp);const c=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!c){const{error:g}=await this.getUser(s);if(g)throw g;return{data:{claims:i,header:n,signature:a},error:null}}const d=Li(n.alg),f=await crypto.subtle.importKey("jwk",c,d,!0,["verify"]);if(!await crypto.subtle.verify(d,f,a,xi(`${o}.${l}`)))throw new zt("Invalid JWT signature");return{data:{claims:i,header:n,signature:a},error:null}}catch(s){if(E(s))return{data:null,error:s};throw s}}}Ye.nextInstanceID=0;const Zi=Ye;class ea extends Zi{constructor(e){super(e)}}var ta=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(d){try{c(s.next(d))}catch(f){a(f)}}function l(d){try{c(s.throw(d))}catch(f){a(f)}}function c(d){d.done?i(d.value):n(d.value).then(o,l)}c((s=s.apply(r,e||[])).next())})};class sa{constructor(e,t,s){var n,i,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=ai(e),l=new URL(o);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,d={db:Xn,realtime:ei,auth:Object.assign(Object.assign({},Zn),{storageKey:c}),global:Qn},f=oi(s??{},d);this.storageKey=(n=f.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=f.global.headers)!==null&&i!==void 0?i:{},f.accessToken?(this.accessToken=f.accessToken,this.auth=new Proxy({},{get:(u,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=f.auth)!==null&&a!==void 0?a:{},this.headers,f.global.fetch),this.fetch=ni(t,this._getAccessToken.bind(this),f.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},f.realtime)),this.rest=new yn(new URL("rest/v1",l).href,{headers:this.headers,schema:f.db.schema,fetch:this.fetch}),this.storage=new Vn(this.storageUrl.href,this.headers,this.fetch,s==null?void 0:s.storage),f.accessToken||this._listenForAuthEvents()}get functions(){return new Jr(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return ta(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,storageKey:i,flowType:a,lock:o,debug:l},c,d){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new ea({url:this.authUrl.href,headers:Object.assign(Object.assign({},f),c),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,flowType:a,lock:o,debug:l,fetch:d,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Nn(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?this.changedAccessToken=s:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const ra=(r,e,t)=>new sa(r,e,t);function na(){if(typeof window<"u"||typeof process>"u")return!1;const r=process.version;if(r==null)return!1;const e=r.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}na();const ia="https://ursnkjhyeupfvlnahuyh.supabase.co",aa="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVyc25ramh5ZXVwZnZsbmFodXloIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ1OTE4OTIsImV4cCI6MjA3MDE2Nzg5Mn0.qqZ3thy2Q5NKARonhDNj4CfCua5slLhRWCqu49eopsM",B=ra(ia,aa,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}}),Ta=Object.freeze(Object.defineProperty({__proto__:null,supabase:B},Symbol.toStringTag,{value:"Module"})),Vs=z.createContext(void 0),oa=()=>{const r=z.useContext(Vs);if(r===void 0)throw new Error("useAuth must be used within an AuthProvider");return r};function Aa({children:r}){const e=la();return z.createElement(Vs.Provider,{value:e},r)}function la(){const[r,e]=z.useState(null),[t,s]=z.useState(null),[n,i]=z.useState(!0),[a,o]=z.useState(!1),l=async g=>{if(!g){o(!1);return}try{const{data:p,error:v}=await B.rpc("get_is_admin");o(v?!1:!!p)}catch{o(!1)}};z.useEffect(()=>{const{data:{subscription:g}}=B.auth.onAuthStateChange((p,v)=>{s(v),e((v==null?void 0:v.user)??null),v!=null&&v.user?setTimeout(()=>{l(v.user)},0):o(!1),i(!1)});return B.auth.getSession().then(({data:{session:p}})=>{s(p),e((p==null?void 0:p.user)??null),p!=null&&p.user&&l(p.user),i(!1)}),()=>g.unsubscribe()},[]);const c=async(g,p)=>{i(!0);const{error:v}=await B.auth.signInWithPassword({email:g,password:p});return v?(We.error(v.message||"Sign in failed"),i(!1),{error:v}):(We.success("Signed in"),i(!1),{error:null})},d=async(g,p)=>{i(!0);const v=`${window.location.origin}/`,{error:y}=await B.auth.signUp({email:g,password:p,options:{emailRedirectTo:v}});return y?(We.error(y.message||"Sign up failed"),i(!1),{error:y}):(We.success("Check your email to confirm your account"),i(!1),{error:null})},f=async()=>{await B.auth.signOut(),e(null),s(null),o(!1),We.success("Signed out")},u=z.useMemo(()=>a?"admin":null,[a]);return{user:r,session:t,isLoading:n,isAdmin:a,adminRole:u,signIn:c,signUp:d,signOut:f}}function ca({title:r,description:e,canonical:t,robots:s,jsonLd:n}){return z.useEffect(()=>{if(typeof document>"u")return;if(r&&(document.title=r),e){let o=document.querySelector('meta[name="description"]');o||(o=document.createElement("meta"),o.setAttribute("name","description"),document.head.appendChild(o)),o.setAttribute("content",e)}if(s){let o=document.querySelector('meta[name="robots"]');o||(o=document.createElement("meta"),o.setAttribute("name","robots"),document.head.appendChild(o)),o.setAttribute("content",s)}if(t){let o=document.querySelector('link[rel="canonical"]');o||(o=document.createElement("link"),o.setAttribute("rel","canonical"),document.head.appendChild(o)),o.setAttribute("href",t)}const i="page-structured-data",a=document.getElementById(i);if(a&&a.remove(),n){const o=document.createElement("script");o.type="application/ld+json",o.id=i,o.text=JSON.stringify(n),document.head.appendChild(o)}},[r,e,t,s,JSON.stringify(n)]),null}const da=[{name:"Executive Dashboard",href:"/admin",icon:pr},{name:"Overview",href:"/admin/overview",icon:Pt},{name:"Submissions",href:"/admin/submissions",icon:Ss},{name:"Analytics",href:"/admin/analytics",icon:Pt}];function Oa(){const[r,e]=z.useState(!1),{user:t,adminRole:s,signOut:n}=oa(),i=lr(),a=async()=>{await n(),i("/admin/login")},o=s==="superadmin";return h.jsxs("div",{className:"min-h-screen bg-background",children:[h.jsx(ca,{title:"Admin | AI Readiness Assessment",description:"Administrative dashboard for AI Readiness Assessment",robots:"noindex,nofollow"}),r&&h.jsx("div",{className:"fixed inset-0 z-40 bg-background/80 backdrop-blur-sm lg:hidden",onClick:()=>e(!1)}),h.jsx("div",{className:ts("fixed inset-y-0 left-0 z-50 w-64 bg-card border-r transform transition-transform duration-200 ease-in-out lg:translate-x-0",r?"translate-x-0":"-translate-x-full"),children:h.jsxs("div",{className:"flex flex-col h-full",children:[h.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[h.jsxs("div",{className:"flex items-center space-x-2",children:[h.jsx("div",{className:"w-8 h-8 bg-primary rounded-lg flex items-center justify-center",children:h.jsx(cr,{className:"h-5 w-5 text-primary-foreground"})}),h.jsx("span",{className:"font-semibold",children:"Admin Portal"})]}),h.jsx(xt,{variant:"ghost",size:"sm",className:"lg:hidden",onClick:()=>e(!1),children:h.jsx(dr,{className:"h-4 w-4"})})]}),h.jsx("nav",{className:"flex-1 px-4 py-4 space-y-2",children:da.map(l=>h.jsxs(ur,{to:l.href,end:l.href==="/admin",className:({isActive:c})=>ts("flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-colors",c?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground hover:bg-muted"),children:[h.jsx(l.icon,{className:"mr-3 h-4 w-4"}),l.name]},l.name))}),h.jsxs("div",{className:"border-t p-4",children:[h.jsxs("div",{className:"flex items-center justify-between mb-3",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium",children:t==null?void 0:t.email}),h.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:s})]}),h.jsx(ot,{variant:o?"default":"secondary",children:o?"Super Admin":"Analyst"})]}),h.jsxs(xt,{variant:"outline",size:"sm",className:"w-full",onClick:a,children:[h.jsx(hr,{className:"mr-2 h-4 w-4"}),"Sign Out"]})]})]})}),h.jsxs("div",{className:"lg:pl-64",children:[h.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-b",children:h.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[h.jsxs("div",{className:"flex items-center space-x-4",children:[h.jsx(xt,{variant:"ghost",size:"sm",className:"lg:hidden",onClick:()=>e(!0),children:h.jsx(fr,{className:"h-4 w-4"})}),h.jsxs("div",{children:[h.jsx("h1",{className:"text-2xl font-bold",children:"AI Readiness Assessment"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Administrative Dashboard"})]})]}),h.jsx("div",{className:"flex items-center space-x-4",children:h.jsx("div",{className:"text-right",children:h.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[h.jsx(ks,{className:"mr-1 h-3 w-3"}),"Last updated: ",new Date().toLocaleTimeString()]})})})]})}),h.jsx("main",{className:"p-6",children:h.jsx(gr,{})})]})]})}function ua(){const[r,e]=z.useState(null),[t,s]=z.useState([]),[n,i]=z.useState(!1),[a,o]=z.useState(null);return{analytics:r,submissions:t,isLoading:n,error:a,fetchAnalytics:async()=>{var g;try{i(!0),o(null);const p=new Date;p.setHours(0,0,0,0);const v=new Date(Date.now()-7*24*60*60*1e3),[y,S,A,w,x]=await Promise.all([B.from("submissions").select("id",{count:"exact",head:!0}),B.from("submissions").select("id",{count:"exact",head:!0}).eq("completed",!0),B.from("submissions").select("id",{count:"exact",head:!0}).gte("created_at",p.toISOString()),B.from("submissions").select("id",{count:"exact",head:!0}).gte("created_at",v.toISOString()),B.from("organizations").select("id")]),_=y.count??0,b=S.count??0,O=A.count??0,H=w.count??0,Y=new Set;x.data,(g=(await B.from("submissions").select("organization_id").not("organization_id","is",null)).data)==null||g.forEach(Z=>{Z.organization_id&&Y.add(Z.organization_id)});const W={total_submissions:_,completed_submissions:b,active_organizations:Y.size,completion_rate:_>0?Math.round(b/_*100):0,today_submissions:O,week_submissions:H};e(W)}catch(p){o(p.message??"Failed to fetch analytics")}finally{i(!1)}},fetchSubmissions:async(g={})=>{var p,v;try{i(!0),o(null);let y=B.from("submissions").select("id, created_at, updated_at, completed, percentage_score, organization_id").order("created_at",{ascending:!1});if(g!=null&&g.dateFilter){const j=new Date;let k=null;g.dateFilter==="today"?(k=new Date,k.setHours(0,0,0,0)):g.dateFilter==="7d"?k=new Date(j.getTime()-7*24*60*60*1e3):g.dateFilter==="30d"&&(k=new Date(j.getTime()-30*24*60*60*1e3)),k&&(y=y.gte("created_at",k.toISOString()))}(g==null?void 0:g.statusFilter)==="completed"&&(y=y.eq("completed",!0)),(g==null?void 0:g.statusFilter)==="incomplete"&&(y=y.eq("completed",!1));const S=await y;if(S.error)throw S.error;const A=S.data||[];if(s([]),A.length===0)return[];const w=A.map(j=>j.id),x=[...new Set(A.map(j=>j.organization_id).filter(Boolean))];let _=B.from("organizations").select("id, name, track, industry, country, size_bucket, revenue_bucket, regulatory_status");g!=null&&g.trackFilter&&(_=_.eq("track",g.trackFilter)),x.length>0?_=_.in("id",x):_=_.in("id",["00000000-0000-0000-0000-000000000000"]);const b=await _;if(b.error)throw b.error;const O=new Map;(p=b.data)==null||p.forEach(j=>O.set(j.id,j));let H=A;if(g!=null&&g.trackFilter){const j=new Set(Array.from(O.keys()));H=A.filter(k=>k.organization_id&&j.has(k.organization_id))}const Y=await B.from("answers").select("submission_id, question_id, raw_response").in("submission_id",H.map(j=>j.id)).in("question_id",["M1","M2","M3"]);if(Y.error)throw Y.error;const ae=new Map,W=new Map,Z=new Map;(v=Y.data)==null||v.forEach(j=>{const k=j.raw_response?typeof j.raw_response=="string"?j.raw_response:j.raw_response[""]:"";j.question_id==="M1"&&ae.set(j.submission_id,k??""),j.question_id==="M2"&&W.set(j.submission_id,k??""),j.question_id==="M3"&&Z.set(j.submission_id,k??"")});const N=H.map(j=>{const k=j.organization_id?O.get(j.organization_id):null,V=Z.get(j.id)||"";return{id:j.id,assessment_id:j.id,created_at:j.created_at,updated_at:j.updated_at,completed:!!j.completed,submission_status:j.completed?"Completed":"In Progress",full_name:ae.get(j.id)||"",email:W.get(j.id)||"",role:V,organization_name:(k==null?void 0:k.name)||"",industry:(k==null?void 0:k.industry)||"",country:(k==null?void 0:k.country)||"",organization_size:(k==null?void 0:k.size_bucket)||"",company_size:(k==null?void 0:k.size_bucket)||"",revenue_range:(k==null?void 0:k.revenue_bucket)||"",regulated:!!(k!=null&&k.regulatory_status),track:(k==null?void 0:k.track)||"",percentage_score:j.percentage_score??null}});if(g!=null&&g.searchTerm){const j=String(g.searchTerm).toLowerCase();s(N.filter(k=>[k.organization_name,k.full_name,k.email,k.track].filter(Boolean).some(V=>String(V).toLowerCase().includes(j))))}else s(N);return N}catch(y){return o(y.message??"Failed to fetch submissions"),[]}finally{i(!1)}},getSubmissionDetails:async g=>{var p,v,y,S,A,w;try{i(!0),o(null);const x=await B.from("submissions").select("id, created_at, updated_at, completed, percentage_score, organization_id").eq("id",g).maybeSingle();if(x.error)throw x.error;const _=x.data;if(!_)return null;let b=null;if(_.organization_id){const N=await B.from("organizations").select("id, name, track, industry, country, size_bucket, revenue_bucket").eq("id",_.organization_id).maybeSingle();if(N.error)throw N.error;b=N.data}const O=await B.from("answers").select("question_id, raw_response").eq("submission_id",g).in("question_id",["M1","M2","M3"]);if(O.error)throw O.error;const H=N=>typeof N=="string"?N:(N==null?void 0:N[""])??"",Y=H((v=(p=O.data)==null?void 0:p.find(N=>N.question_id==="M1"))==null?void 0:v.raw_response),ae=H((S=(y=O.data)==null?void 0:y.find(N=>N.question_id==="M2"))==null?void 0:S.raw_response),W=H((w=(A=O.data)==null?void 0:A.find(N=>N.question_id==="M3"))==null?void 0:w.raw_response);return{id:_.id,assessment_id:_.id,created_at:_.created_at,updated_at:_.updated_at,submission_status:_.completed?"Completed":"In Progress",full_name:Y,email:ae,organization_name:(b==null?void 0:b.name)||"",industry:(b==null?void 0:b.industry)||"",country:(b==null?void 0:b.country)||"",organization_size:(b==null?void 0:b.size_bucket)||"",revenue_range:(b==null?void 0:b.revenue_bucket)||"",track:(b==null?void 0:b.track)||"",percentage_score:_.percentage_score??null,role_answer:W}}catch(x){return o(x.message??"Failed to get submission details"),null}finally{i(!1)}},deleteSubmission:async g=>{try{i(!0),o(null);const{error:p}=await B.from("submissions").delete().eq("id",g);if(p)throw p;s(v=>v.filter(y=>y.id!==g))}catch(p){o(p.message??"Failed to delete submission")}finally{i(!1)}},exportToCSV:g=>{const p=["id","organization_name","full_name","email","role","track","completed","submission_status","created_at","percentage_score","industry","country","company_size","organization_size","revenue_range"],v=x=>{const _=x==null?"":String(x);return _.includes(",")||_.includes('"')||_.includes(`
`)?'"'+_.replace(/"/g,'""')+'"':_},y=[p.join(","),...g.map(x=>p.map(_=>v(x[_])).join(","))].join(`
`),S=new Blob([y],{type:"text/csv;charset=utf-8;"}),A=URL.createObjectURL(S),w=document.createElement("a");w.href=A,w.setAttribute("download",`submissions_${new Date().toISOString().slice(0,19)}.csv`),document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(A)}}}function ha(){const{analytics:r,submissions:e,isLoading:t}=ua(),s=z.useMemo(()=>Array.from({length:7},(c,d)=>{const f=new Date;return f.setDate(f.getDate()-d),f.toISOString().split("T")[0]}).reverse().map(c=>({date:c,completions:e.filter(d=>d.completed&&d.created_at.split("T")[0]===c).length})),[e]),n=z.useMemo(()=>{const l=e.filter(d=>d.completed).length,c=e.length-l;return[{name:"Completed",value:l,color:"bg-green-500"},{name:"In Progress",value:c,color:"bg-yellow-500"}]},[e]),i=z.useMemo(()=>{const l=e.reduce((c,d)=>{const f=d.organization_name||"Unknown";return c[f]=(c[f]||0)+1,c},{});return Object.entries(l).sort(([,c],[,d])=>d-c).slice(0,10).map(([c,d])=>({org:c,count:d}))},[e]),a=[{section:"Profile",completion:100,dropoff:0},{section:"Strategy",completion:85,dropoff:15},{section:"Data",completion:78,dropoff:7},{section:"Tools",completion:72,dropoff:6},{section:"Automation",completion:65,dropoff:7},{section:"People",completion:58,dropoff:7},{section:"Governance",completion:52,dropoff:6}],o=z.useMemo(()=>{const l=e.reduce((c,d)=>(c[d.track]=(c[d.track]||0)+1,c),{});return Object.entries(l).map(([c,d])=>({track:c,count:d,percentage:e.length>0?(d/e.length*100).toFixed(1):"0"}))},[e]);return t?h.jsx("div",{className:"space-y-6",children:h.jsxs("div",{className:"animate-pulse",children:[h.jsx("div",{className:"h-8 bg-muted rounded w-1/4 mb-6"}),h.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[...Array(4)].map((l,c)=>h.jsx("div",{className:"h-80 bg-muted rounded"},c))})]})}):h.jsxs("div",{className:"space-y-6",children:[h.jsx("div",{className:"flex items-center justify-between",children:h.jsxs("div",{children:[h.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Analytics"}),h.jsx("p",{className:"text-muted-foreground",children:"Deep insights into assessment performance and user behavior"})]})}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[h.jsxs(oe,{children:[h.jsxs(le,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[h.jsx(ce,{className:"text-sm font-medium",children:"Avg Completion Time"}),h.jsx(ks,{className:"h-4 w-4 text-muted-foreground"})]}),h.jsxs(de,{children:[h.jsx("div",{className:"text-2xl font-bold",children:"12m 34s"}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"-2m from last week"})]})]}),h.jsxs(oe,{children:[h.jsxs(le,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[h.jsx(ce,{className:"text-sm font-medium",children:"Drop-off Rate"}),h.jsx(ss,{className:"h-4 w-4 text-muted-foreground"})]}),h.jsxs(de,{children:[h.jsx("div",{className:"text-2xl font-bold",children:"15.2%"}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"+2.1% from last week"})]})]}),h.jsxs(oe,{children:[h.jsxs(le,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[h.jsx(ce,{className:"text-sm font-medium",children:"Peak Hours"}),h.jsx(mr,{className:"h-4 w-4 text-muted-foreground"})]}),h.jsxs(de,{children:[h.jsx("div",{className:"text-2xl font-bold",children:"10-11 AM"}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Most active time"})]})]}),h.jsxs(oe,{children:[h.jsxs(le,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[h.jsx(ce,{className:"text-sm font-medium",children:"Return Rate"}),h.jsx(vr,{className:"h-4 w-4 text-muted-foreground"})]}),h.jsxs(de,{children:[h.jsx("div",{className:"text-2xl font-bold",children:"23.5%"}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Users completing multiple"})]})]})]}),h.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[h.jsxs(oe,{children:[h.jsxs(le,{children:[h.jsxs(ce,{className:"flex items-center",children:[h.jsx(Pt,{className:"mr-2 h-5 w-5"}),"Completion Trends (7 Days)"]}),h.jsx(Fe,{children:"Daily assessment completions"})]}),h.jsx(de,{children:h.jsx("div",{className:"space-y-3",children:s.map((l,c)=>h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("span",{className:"text-sm",children:new Date(l.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}),h.jsxs("div",{className:"flex items-center space-x-2",children:[h.jsx("div",{className:"w-32",children:h.jsx(rs,{value:l.completions/Math.max(...s.map(d=>d.completions),1)*100,className:"h-2"})}),h.jsx("span",{className:"text-sm font-medium w-8 text-right",children:l.completions})]})]},l.date))})})]}),h.jsxs(oe,{children:[h.jsxs(le,{children:[h.jsxs(ce,{className:"flex items-center",children:[h.jsx(yr,{className:"mr-2 h-5 w-5"}),"Status Distribution"]}),h.jsx(Fe,{children:"Assessment completion status breakdown"})]}),h.jsx(de,{children:h.jsxs("div",{className:"space-y-4",children:[n.map(l=>h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"flex items-center space-x-3",children:[h.jsx("div",{className:`w-3 h-3 rounded-full ${l.color}`}),h.jsx("span",{className:"text-sm font-medium",children:l.name})]}),h.jsxs("div",{className:"flex items-center space-x-2",children:[h.jsx("span",{className:"text-sm",children:l.value}),h.jsxs(ot,{variant:"outline",children:[e.length>0?(l.value/e.length*100).toFixed(0):0,"%"]})]})]},l.name)),h.jsx("div",{className:"pt-2 border-t",children:h.jsxs("div",{className:"flex justify-between text-sm",children:[h.jsx("span",{className:"font-medium",children:"Total Submissions"}),h.jsx("span",{className:"font-bold",children:e.length})]})})]})})]}),h.jsxs(oe,{children:[h.jsxs(le,{children:[h.jsxs(ce,{className:"flex items-center",children:[h.jsx(Ss,{className:"mr-2 h-5 w-5"}),"Top Organizations"]}),h.jsx(Fe,{children:"Organizations by submission volume"})]}),h.jsx(de,{children:h.jsxs("div",{className:"space-y-3",children:[i.slice(0,8).map((l,c)=>h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"flex items-center space-x-3",children:[h.jsx("div",{className:"w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center text-xs font-medium",children:c+1}),h.jsx("span",{className:"text-sm font-medium truncate max-w-40",children:l.org})]}),h.jsx(ot,{variant:"secondary",children:l.count})]},l.org)),i.length===0&&h.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No organization data available yet"})]})})]}),h.jsxs(oe,{children:[h.jsxs(le,{children:[h.jsxs(ce,{className:"flex items-center",children:[h.jsx(ss,{className:"mr-2 h-5 w-5"}),"Section Drop-off Rates"]}),h.jsx(Fe,{children:"User retention through assessment sections"})]}),h.jsx(de,{children:h.jsx("div",{className:"space-y-3",children:a.map(l=>h.jsxs("div",{className:"space-y-1",children:[h.jsxs("div",{className:"flex items-center justify-between text-sm",children:[h.jsx("span",{className:"font-medium",children:l.section}),h.jsxs("span",{className:"text-muted-foreground",children:[l.completion,"% (",l.dropoff,"% drop)"]})]}),h.jsx(rs,{value:l.completion,className:"h-2"})]},l.section))})})]})]}),h.jsxs(oe,{children:[h.jsxs(le,{children:[h.jsx(ce,{children:"Assessment Track Distribution"}),h.jsx(Fe,{children:"How users are categorized across different tracks"})]}),h.jsx(de,{children:h.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:o.map(l=>h.jsxs("div",{className:"text-center space-y-2",children:[h.jsx("div",{className:"text-3xl font-bold",children:l.count}),h.jsx("div",{className:"text-sm text-muted-foreground",children:l.track==="TECH"?"Technical Track":l.track==="REG"?"Regulated Track":"General Track"}),h.jsxs(ot,{variant:"outline",children:[l.percentage,"%"]})]},l.track))})})]})]})}const Pa=Object.freeze(Object.defineProperty({__proto__:null,AnalyticsDashboard:ha},Symbol.toStringTag,{value:"Module"}));export{Aa as A,We as J,ca as S,ma as T,Qe as _,Oa as a,ua as b,Ta as c,Pa as d,B as s,oa as u};
