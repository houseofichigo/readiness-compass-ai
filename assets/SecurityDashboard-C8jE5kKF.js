import{j as e}from"./ui-TC4ngNOa.js";import{r as d}from"./vendor-DXsvu-ZH.js";import{p as b,m as j,q as w,S as A,B as E,R as S,e as r,f as a,g as c,A as L,h as l,am as C,U as D,a as R}from"./assessment-D5mlHxXY.js";import{u as H,s as F,J as B}from"./admin-DJvmEyK8.js";function I(){const{isAdmin:x}=H(),[u,p]=d.useState([]),[o,h]=d.useState(!0),[n,g]=d.useState({totalEvents:0,recentFailures:0,rateLimitHits:0,suspiciousActivity:0}),f=async()=>{if(x)try{h(!0);const{data:s,error:i}=await F.from("security_events").select("*").order("created_at",{ascending:!1}).limit(50);if(i)throw i;p((s||[]).map(t=>({...t,ip_address:t.ip_address,user_id:t.user_id,user_agent:t.user_agent})));const y=new Date,_=new Date(y.getTime()-24*60*60*1e3),m=(s==null?void 0:s.filter(t=>new Date(t.created_at)>_))||[];g({totalEvents:(s==null?void 0:s.length)||0,recentFailures:m.filter(t=>t.event_type.includes("failure")||t.event_type.includes("error")).length,rateLimitHits:m.filter(t=>t.event_type.includes("rate_limit")).length,suspiciousActivity:m.filter(t=>t.event_type.includes("suspicious")||t.event_type.includes("invalid")).length})}catch{B.error("Failed to load security events")}finally{h(!1)}};d.useEffect(()=>{f()},[x]);const N=s=>s.includes("failure")||s.includes("error")?"destructive":s.includes("rate_limit")||s.includes("suspicious")?"secondary":s.includes("success")?"default":"outline",v=s=>s.split("_").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" ");return x?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Security Dashboard"})]}),e.jsxs(E,{onClick:f,disabled:o,children:[e.jsx(S,{className:`h-4 w-4 mr-2 ${o?"animate-spin":""}`}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(r,{children:[e.jsx(a,{className:"pb-2",children:e.jsxs(c,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4"}),"Total Events"]})}),e.jsxs(l,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n.totalEvents}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All time"})]})]}),e.jsxs(r,{children:[e.jsx(a,{className:"pb-2",children:e.jsxs(c,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(j,{className:"h-4 w-4 text-destructive"}),"Recent Failures"]})}),e.jsxs(l,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n.recentFailures}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Last 24 hours"})]})]}),e.jsxs(r,{children:[e.jsx(a,{className:"pb-2",children:e.jsxs(c,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4 text-secondary"}),"Rate Limit Hits"]})}),e.jsxs(l,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n.rateLimitHits}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Last 24 hours"})]})]}),e.jsxs(r,{children:[e.jsx(a,{className:"pb-2",children:e.jsxs(c,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4 text-warning"}),"Suspicious Activity"]})}),e.jsxs(l,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n.suspiciousActivity}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Last 24 hours"})]})]})]}),e.jsxs(r,{children:[e.jsx(a,{children:e.jsx(c,{children:"Recent Security Events"})}),e.jsx(l,{children:o?e.jsx("div",{className:"text-center py-4",children:"Loading security events..."}):u.length===0?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"No security events found"}):e.jsx("div",{className:"space-y-4",children:u.slice(0,20).map(s=>e.jsx("div",{className:"flex items-start gap-3 p-3 border rounded-lg",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(R,{variant:N(s.event_type),children:v(s.event_type)}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(s.created_at).toLocaleString()})]}),s.ip_address&&e.jsxs("div",{className:"text-xs text-muted-foreground mb-1",children:["IP: ",s.ip_address]}),s.event_data&&e.jsx("div",{className:"text-xs font-mono bg-muted p-2 rounded mt-2",children:JSON.stringify(s.event_data,null,2)})]})},s.id))})})]})]}):e.jsxs(b,{variant:"destructive",children:[e.jsx(j,{className:"h-4 w-4"}),e.jsx(w,{children:"Access denied. Administrator privileges required."})]})}export{I as SecurityDashboard};
